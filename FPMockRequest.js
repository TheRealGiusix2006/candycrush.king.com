var currentProfile = parseInt(localStorage.getItem('selectedProfile')) || 1;

let loadedLevels = {}
let gameModesPerLevel = []

function decodeParams(params) {
    let decoded={}
    for (let param of decodeURIComponent(params).split("&").map((param)=>param.split('='))) {
        decoded[param[0]]=param[1]
    }
    return decoded
}

function set(key, obj) {
    localStorage.setItem(key, JSON.stringify(obj))
}

function get(key) {
    return JSON.parse(localStorage.getItem(key))
}

/*
I don't believe the "type" name matters too much for this specifically
[
{
"typeId": "1234",
"amount": 1234,
"type": "CandyColorBomb",
"category": "candyBooster", (or "candyCharm" or "candyCurrency")
}
]
*/

function addBoosters(boosters, unlock) {

    //console.log(boosters)
    let data = getBoosters(true)
    //console.log(boosters, unlock)
    for (let booster of boosters) {
        //console.log(booster.type, booster.amount)
        // list of boosters you're "allowed" to add
        //console.log(`checking booster ${booster.type} allowd to be added`)
        //if (window.AllowedBoosters.includes(booster.type)) {
            //console.log(` booster ${booster.type} is allowed to be added`)
            //console.log(booster.type)

            let boosterTypeId = window.boosterIdentifiers[booster.type]
            if (boosterTypeId && boosterTypeId!==3280) {
                let existingBooster = data.find((invbooster)=>invbooster.type == booster.type)
                let unlockThis = unlock || !window.UnlockBoosters.includes(booster.type)
                if (!existingBooster) {
                    //console.log('adding new booster')
                    existingBooster = {
                        type: booster.type,
                        category:"candyBooster",
                        typeId: parseInt(boosterTypeId),
                        amount: 0,
                        availability: 2,
                        leaseStatus: 0
                    }

                    if (booster.type.includes("Charm")) {
                        existingBooster.category = "candyCharm"
                    }

                    data.push(existingBooster)
                }
                //console.log('adding booster')
                existingBooster.amount+=booster.amount
                
                if (existingBooster.amount < 0) {
                    existingBooster.amount = 0
                }

                if (unlockThis) {
                    //console.log('unlocking booster')
                    existingBooster.unlocked = true
                }
            }
        //}
    }
    set('boosters_' + currentProfile, data)
    return data.filter((booster)=>booster.unlocked)
}

function removeBoosters(boosters) {
    for (let booster of boosters) {
        booster.amount *= -1
    }
    //console.log('removing', boosters)
    return addBoosters(boosters)
}

function getBoosters(includeLocked) {
    let data = get('boosters_' + currentProfile)
    if (!data) {
        data = []
        set('boosters_' + currentProfile, data)
    }
    if (!includeLocked) {
        data = data.filter((booster)=>booster.unlocked)
    }
    return data.sort(function (a,b){
        let atype = a.typeId
        let btype = b.typeId

        if (a.category === "candyCharm") {
            atype+=10000
        }
        if (b.category === "candyCharm") {
            btype+=10000
        }
        return btype-atype
    })


}

// gold needs to be concatenated here
function getBalance() {
    let currentUser = getCurrentUser()
    return getBoosters(false).concat([{"typeId":3280,"type":"CandyHardCurrency","category":"candyCurrency","amount":currentUser.gold,"availability":0,"leaseStatus":0}])
}

/*
  "currentUser": {
    "userId": "937",
    "lives": 5,
    "timeToNextRegeneration": -1,
    "gold": 0,
    "unlockedBoosters": [
    ],
    "soundFx": true,
    "soundMusic": true,
    "maxLives": 5,
    "immortal": true,
    "mobileConnected": false,
    "currency": "CAD",
    "altCurrency": "KHC",
    "preAuth": false,
    "boosterInventory": {
    }
  },
*/

function getCurrentUser() {
    //set currentuser data if its not already set
    let data = get('currentUser_' + currentProfile)
    if (!data) {
        data = {
            lives: 5,
            maxLives: 5,
            timeToNextRegeneration: -1000,
            timeStampLastLivesCheck: -1,
            gold: 0,
            soundFx: true,
            soundMusic: true
        }
        set('currentUser_' + currentProfile, data)
    }

    calcLives(data)

    return {
        userId: "937",
        lives: data.lives,
        timeToNextRegeneration: Math.floor(data.timeToNextRegeneration/1000),
        maxLives: data.maxLives,
        gold: data.gold,
        unlockedBoosters: getBoosters(false).map((booster)=>parseInt(booster.typeId)),
        soundFx: data.soundFx,
        soundMusic: data.soundMusic,
        immortal: false,
        mobileConnected: false,
        currency: "CAD",
        altCurrency: "KHC",
        preAuth: false,
        boosterInventory: {}
    }
}

function calcLives(data) {
    let now = Date.now()
    if (data.lives < data.maxLives) {
        // see how long it was since the last check, and compare with the 
        // time until a life regenerates
        let long = now - data.timeStampLastLivesCheck
        let addLife = data.timeToNextRegeneration - long
        if (addLife > 0) {
            // if its not yet just update the timestamp
            data.timeToNextRegeneration = data.timeToNextRegeneration - long
        } else {
            // otherwise see how many lives need to be added
            addLife = -addLife;
            data.lives += 1
            data.lives += Math.floor(addLife/1800000);
            data.timeToNextRegeneration = 1800000 - (addLife % 1800000);
        }
    }

    data.timeStampLastLivesCheck = now

    data.lives = Math.max(Math.min(data.lives, data.maxLives), 0)
    if (data.lives == data.maxLives) {
        data.timeToNextRegeneration = -1000
    }
    set('currentUser_' + currentProfile, data)
}

// I cba to check if it's the **NEXT** day, I'll just check if it's a DIFFERENT day than before.
window.isWheelActive = function() {
    let data = get('wheelData_' + currentProfile)
    if (!data) {
        return true
    }
    let currentDate = new Date()
    return (data.lastDay != currentDate.getDate() || data.lastMonth != currentDate.getMonth() || data.lastYear != currentDate.getFullYear())
}

let wheelPrizes = [
    "CandyHammer",
    "CandyColorBomb",
    "CandySwedishFish",
    "CandyStripedWrapped",
    "CandyJoker",
    "CandyCoconutLiquorice",
    "CandyFreeSwitch"
]
// 1/100
let JackpotChance = 100
let JackpotItem = "CandyWheelOfBoosterJackpot"

function getWheelPrize() {
    if (window.isWheelActive()) {
        let date = new Date()
        let data = {
            lastDay: date.getDate(),
            lastMonth: date.getMonth(),
            lastYear: date.getFullYear()
        }
        set('wheelData_' + currentProfile, data)
        let random = Math.floor(Math.random() * JackpotChance) + 1
        let prize = wheelPrizes[Math.floor(Math.random() * wheelPrizes.length)]
        if (random !== 1) {
            //console.log('wheel prize today is ' + prize)
            addBoosters([{type: prize, amount:1}])
            return prize
        } else {
            //console.log('wheel prize today is JACKPOT')
            addBoosters(wheelPrizes.map((booster)=>({type:booster, amount:3})))
            return JackpotItem
        }
    }
    return ""
}

var initialEpisodes = [
  {
	"id": 1,
	"levels": [{"id":1,"episodeId":1,"score":0,"stars":0,"unlocked":true,"completedAt":-1,"unlockConditionDataList":[]}]
  },
  {
	"id": 1201,
	"levels": [
	  {
		"id": 1,
		"episodeId": 1201,
		"score": 0,
		"stars": 0,
		"unlocked": true,
		"completedAt": -1,
		"unlockConditionDataList": []
	  }
	]
  }
];

var episodeLevelCount = {"1":10,"2":10,"3":15,"4":15,"5":15,"6":15,"7":15,"8":15,"9":15,"10":15,"11":15,"12":15,"13":15,"14":15,"15":15,"16":15,"17":15,"18":15,"19":15,"20":15,"21":15,"22":15,"23":15,"24":15,"25":15,"26":15,"27":15,"28":15,"29":15,"30":15,"31":15,"32":15,"33":15,"34":15,"35":15,"36":15,"37":15,"38":15,"39":15,"40":15,"41":15,"42":15,"43":15,"44":15,"45":15,"46":15,"47":15,"48":15,"49":15,"50":15,"51":15,"52":15,"53":15,"54":15,"55":15,"56":15,"57":15,"58":15,"59":15,"60":15,"61":15,"62":15,"63":15,"64":15,"65":15,"66":15,"67":15,"68":15,"69":15,"70":15,"71":15,"72":15,"73":15,"74":15,"75":15,"76":15,"77":15,"78":15,"79":15,"80":15,"81":15,"82":15,"83":15,"84":15,"85":15,"86":15,"87":15,"88":15,"89":15,"90":15,"91":15,"92":15,"93":15,"94":15,"95":15,"96":15,"97":15,"98":15,"99":15,"100":15,"101":15,"102":15,"103":15,"104":15,"105":15,"106":15,"107":15,"108":15,"109":15,"110":15,"111":15,"112":15,"113":15,"114":15,"115":15,"116":15,"117":15,"118":15,"119":15,"120":15,"121":15,"122":15,"123":15,"124":15,"125":15,"126":15,"127":15,"128":15,"129":15,"130":15,"131":15,"132":15,"133":15,"134":15,"135":15,"136":15,"137":15,"138":15,"139":15,"140":15,"141":15,"142":15,"143":15,"144":15,"145":15,"146":15,"147":15,"148":15,"149":15,"150":15,"151":15,"152":15,"153":15,"154":15,"155":15,"156":15,"157":15,"158":15,"159":15,"160":15,"161":15,"162":15,"163":15,"164":15,"165":15,"166":15,"167":15,"168":15,"169":15,"170":15,"171":15,"172":15,"173":15,"174":15,"175":15,"176":15,"177":15,"178":15,"179":15,"180":15,"181":15,"182":15,"183":15,"184":15,"185":15,"186":15,"187":15,"188":15,"189":15};
var levelInfo = {"1":[1,1],"2":[1,2],"3":[1,3],"4":[1,4],"5":[1,5],"6":[1,6],"7":[1,7],"8":[1,8],"9":[1,9],"10":[1,10],"11":[2,1],"12":[2,2],"13":[2,3],"14":[2,4],"15":[2,5],"16":[2,6],"17":[2,7],"18":[2,8],"19":[2,9],"20":[2,10],"21":[3,1],"22":[3,2],"23":[3,3],"24":[3,4],"25":[3,5],"26":[3,6],"27":[3,7],"28":[3,8],"29":[3,9],"30":[3,10],"31":[3,11],"32":[3,12],"33":[3,13],"34":[3,14],"35":[3,15],"36":[4,1],"37":[4,2],"38":[4,3],"39":[4,4],"40":[4,5],"41":[4,6],"42":[4,7],"43":[4,8],"44":[4,9],"45":[4,10],"46":[4,11],"47":[4,12],"48":[4,13],"49":[4,14],"50":[4,15],"51":[5,1],"52":[5,2],"53":[5,3],"54":[5,4],"55":[5,5],"56":[5,6],"57":[5,7],"58":[5,8],"59":[5,9],"60":[5,10],"61":[5,11],"62":[5,12],"63":[5,13],"64":[5,14],"65":[5,15],"66":[6,1],"67":[6,2],"68":[6,3],"69":[6,4],"70":[6,5],"71":[6,6],"72":[6,7],"73":[6,8],"74":[6,9],"75":[6,10],"76":[6,11],"77":[6,12],"78":[6,13],"79":[6,14],"80":[6,15],"81":[7,1],"82":[7,2],"83":[7,3],"84":[7,4],"85":[7,5],"86":[7,6],"87":[7,7],"88":[7,8],"89":[7,9],"90":[7,10],"91":[7,11],"92":[7,12],"93":[7,13],"94":[7,14],"95":[7,15],"96":[8,1],"97":[8,2],"98":[8,3],"99":[8,4],"100":[8,5],"101":[8,6],"102":[8,7],"103":[8,8],"104":[8,9],"105":[8,10],"106":[8,11],"107":[8,12],"108":[8,13],"109":[8,14],"110":[8,15],"111":[9,1],"112":[9,2],"113":[9,3],"114":[9,4],"115":[9,5],"116":[9,6],"117":[9,7],"118":[9,8],"119":[9,9],"120":[9,10],"121":[9,11],"122":[9,12],"123":[9,13],"124":[9,14],"125":[9,15],"126":[10,1],"127":[10,2],"128":[10,3],"129":[10,4],"130":[10,5],"131":[10,6],"132":[10,7],"133":[10,8],"134":[10,9],"135":[10,10],"136":[10,11],"137":[10,12],"138":[10,13],"139":[10,14],"140":[10,15],"141":[11,1],"142":[11,2],"143":[11,3],"144":[11,4],"145":[11,5],"146":[11,6],"147":[11,7],"148":[11,8],"149":[11,9],"150":[11,10],"151":[11,11],"152":[11,12],"153":[11,13],"154":[11,14],"155":[11,15],"156":[12,1],"157":[12,2],"158":[12,3],"159":[12,4],"160":[12,5],"161":[12,6],"162":[12,7],"163":[12,8],"164":[12,9],"165":[12,10],"166":[12,11],"167":[12,12],"168":[12,13],"169":[12,14],"170":[12,15],"171":[13,1],"172":[13,2],"173":[13,3],"174":[13,4],"175":[13,5],"176":[13,6],"177":[13,7],"178":[13,8],"179":[13,9],"180":[13,10],"181":[13,11],"182":[13,12],"183":[13,13],"184":[13,14],"185":[13,15],"186":[14,1],"187":[14,2],"188":[14,3],"189":[14,4],"190":[14,5],"191":[14,6],"192":[14,7],"193":[14,8],"194":[14,9],"195":[14,10],"196":[14,11],"197":[14,12],"198":[14,13],"199":[14,14],"200":[14,15],"201":[15,1],"202":[15,2],"203":[15,3],"204":[15,4],"205":[15,5],"206":[15,6],"207":[15,7],"208":[15,8],"209":[15,9],"210":[15,10],"211":[15,11],"212":[15,12],"213":[15,13],"214":[15,14],"215":[15,15],"216":[16,1],"217":[16,2],"218":[16,3],"219":[16,4],"220":[16,5],"221":[16,6],"222":[16,7],"223":[16,8],"224":[16,9],"225":[16,10],"226":[16,11],"227":[16,12],"228":[16,13],"229":[16,14],"230":[16,15],"231":[17,1],"232":[17,2],"233":[17,3],"234":[17,4],"235":[17,5],"236":[17,6],"237":[17,7],"238":[17,8],"239":[17,9],"240":[17,10],"241":[17,11],"242":[17,12],"243":[17,13],"244":[17,14],"245":[17,15],"246":[18,1],"247":[18,2],"248":[18,3],"249":[18,4],"250":[18,5],"251":[18,6],"252":[18,7],"253":[18,8],"254":[18,9],"255":[18,10],"256":[18,11],"257":[18,12],"258":[18,13],"259":[18,14],"260":[18,15],"261":[19,1],"262":[19,2],"263":[19,3],"264":[19,4],"265":[19,5],"266":[19,6],"267":[19,7],"268":[19,8],"269":[19,9],"270":[19,10],"271":[19,11],"272":[19,12],"273":[19,13],"274":[19,14],"275":[19,15],"276":[20,1],"277":[20,2],"278":[20,3],"279":[20,4],"280":[20,5],"281":[20,6],"282":[20,7],"283":[20,8],"284":[20,9],"285":[20,10],"286":[20,11],"287":[20,12],"288":[20,13],"289":[20,14],"290":[20,15],"291":[21,1],"292":[21,2],"293":[21,3],"294":[21,4],"295":[21,5],"296":[21,6],"297":[21,7],"298":[21,8],"299":[21,9],"300":[21,10],"301":[21,11],"302":[21,12],"303":[21,13],"304":[21,14],"305":[21,15],"306":[22,1],"307":[22,2],"308":[22,3],"309":[22,4],"310":[22,5],"311":[22,6],"312":[22,7],"313":[22,8],"314":[22,9],"315":[22,10],"316":[22,11],"317":[22,12],"318":[22,13],"319":[22,14],"320":[22,15],"321":[23,1],"322":[23,2],"323":[23,3],"324":[23,4],"325":[23,5],"326":[23,6],"327":[23,7],"328":[23,8],"329":[23,9],"330":[23,10],"331":[23,11],"332":[23,12],"333":[23,13],"334":[23,14],"335":[23,15],"336":[24,1],"337":[24,2],"338":[24,3],"339":[24,4],"340":[24,5],"341":[24,6],"342":[24,7],"343":[24,8],"344":[24,9],"345":[24,10],"346":[24,11],"347":[24,12],"348":[24,13],"349":[24,14],"350":[24,15],"351":[25,1],"352":[25,2],"353":[25,3],"354":[25,4],"355":[25,5],"356":[25,6],"357":[25,7],"358":[25,8],"359":[25,9],"360":[25,10],"361":[25,11],"362":[25,12],"363":[25,13],"364":[25,14],"365":[25,15],"366":[26,1],"367":[26,2],"368":[26,3],"369":[26,4],"370":[26,5],"371":[26,6],"372":[26,7],"373":[26,8],"374":[26,9],"375":[26,10],"376":[26,11],"377":[26,12],"378":[26,13],"379":[26,14],"380":[26,15],"381":[27,1],"382":[27,2],"383":[27,3],"384":[27,4],"385":[27,5],"386":[27,6],"387":[27,7],"388":[27,8],"389":[27,9],"390":[27,10],"391":[27,11],"392":[27,12],"393":[27,13],"394":[27,14],"395":[27,15],"396":[28,1],"397":[28,2],"398":[28,3],"399":[28,4],"400":[28,5],"401":[28,6],"402":[28,7],"403":[28,8],"404":[28,9],"405":[28,10],"406":[28,11],"407":[28,12],"408":[28,13],"409":[28,14],"410":[28,15],"411":[29,1],"412":[29,2],"413":[29,3],"414":[29,4],"415":[29,5],"416":[29,6],"417":[29,7],"418":[29,8],"419":[29,9],"420":[29,10],"421":[29,11],"422":[29,12],"423":[29,13],"424":[29,14],"425":[29,15],"426":[30,1],"427":[30,2],"428":[30,3],"429":[30,4],"430":[30,5],"431":[30,6],"432":[30,7],"433":[30,8],"434":[30,9],"435":[30,10],"436":[30,11],"437":[30,12],"438":[30,13],"439":[30,14],"440":[30,15],"441":[31,1],"442":[31,2],"443":[31,3],"444":[31,4],"445":[31,5],"446":[31,6],"447":[31,7],"448":[31,8],"449":[31,9],"450":[31,10],"451":[31,11],"452":[31,12],"453":[31,13],"454":[31,14],"455":[31,15],"456":[32,1],"457":[32,2],"458":[32,3],"459":[32,4],"460":[32,5],"461":[32,6],"462":[32,7],"463":[32,8],"464":[32,9],"465":[32,10],"466":[32,11],"467":[32,12],"468":[32,13],"469":[32,14],"470":[32,15],"471":[33,1],"472":[33,2],"473":[33,3],"474":[33,4],"475":[33,5],"476":[33,6],"477":[33,7],"478":[33,8],"479":[33,9],"480":[33,10],"481":[33,11],"482":[33,12],"483":[33,13],"484":[33,14],"485":[33,15],"486":[34,1],"487":[34,2],"488":[34,3],"489":[34,4],"490":[34,5],"491":[34,6],"492":[34,7],"493":[34,8],"494":[34,9],"495":[34,10],"496":[34,11],"497":[34,12],"498":[34,13],"499":[34,14],"500":[34,15],"501":[35,1],"502":[35,2],"503":[35,3],"504":[35,4],"505":[35,5],"506":[35,6],"507":[35,7],"508":[35,8],"509":[35,9],"510":[35,10],"511":[35,11],"512":[35,12],"513":[35,13],"514":[35,14],"515":[35,15],"516":[36,1],"517":[36,2],"518":[36,3],"519":[36,4],"520":[36,5],"521":[36,6],"522":[36,7],"523":[36,8],"524":[36,9],"525":[36,10],"526":[36,11],"527":[36,12],"528":[36,13],"529":[36,14],"530":[36,15],"531":[37,1],"532":[37,2],"533":[37,3],"534":[37,4],"535":[37,5],"536":[37,6],"537":[37,7],"538":[37,8],"539":[37,9],"540":[37,10],"541":[37,11],"542":[37,12],"543":[37,13],"544":[37,14],"545":[37,15],"546":[38,1],"547":[38,2],"548":[38,3],"549":[38,4],"550":[38,5],"551":[38,6],"552":[38,7],"553":[38,8],"554":[38,9],"555":[38,10],"556":[38,11],"557":[38,12],"558":[38,13],"559":[38,14],"560":[38,15],"561":[39,1],"562":[39,2],"563":[39,3],"564":[39,4],"565":[39,5],"566":[39,6],"567":[39,7],"568":[39,8],"569":[39,9],"570":[39,10],"571":[39,11],"572":[39,12],"573":[39,13],"574":[39,14],"575":[39,15],"576":[40,1],"577":[40,2],"578":[40,3],"579":[40,4],"580":[40,5],"581":[40,6],"582":[40,7],"583":[40,8],"584":[40,9],"585":[40,10],"586":[40,11],"587":[40,12],"588":[40,13],"589":[40,14],"590":[40,15],"591":[41,1],"592":[41,2],"593":[41,3],"594":[41,4],"595":[41,5],"596":[41,6],"597":[41,7],"598":[41,8],"599":[41,9],"600":[41,10],"601":[41,11],"602":[41,12],"603":[41,13],"604":[41,14],"605":[41,15],"606":[42,1],"607":[42,2],"608":[42,3],"609":[42,4],"610":[42,5],"611":[42,6],"612":[42,7],"613":[42,8],"614":[42,9],"615":[42,10],"616":[42,11],"617":[42,12],"618":[42,13],"619":[42,14],"620":[42,15],"621":[43,1],"622":[43,2],"623":[43,3],"624":[43,4],"625":[43,5],"626":[43,6],"627":[43,7],"628":[43,8],"629":[43,9],"630":[43,10],"631":[43,11],"632":[43,12],"633":[43,13],"634":[43,14],"635":[43,15],"636":[44,1],"637":[44,2],"638":[44,3],"639":[44,4],"640":[44,5],"641":[44,6],"642":[44,7],"643":[44,8],"644":[44,9],"645":[44,10],"646":[44,11],"647":[44,12],"648":[44,13],"649":[44,14],"650":[44,15],"651":[45,1],"652":[45,2],"653":[45,3],"654":[45,4],"655":[45,5],"656":[45,6],"657":[45,7],"658":[45,8],"659":[45,9],"660":[45,10],"661":[45,11],"662":[45,12],"663":[45,13],"664":[45,14],"665":[45,15],"666":[46,1],"667":[46,2],"668":[46,3],"669":[46,4],"670":[46,5],"671":[46,6],"672":[46,7],"673":[46,8],"674":[46,9],"675":[46,10],"676":[46,11],"677":[46,12],"678":[46,13],"679":[46,14],"680":[46,15],"681":[47,1],"682":[47,2],"683":[47,3],"684":[47,4],"685":[47,5],"686":[47,6],"687":[47,7],"688":[47,8],"689":[47,9],"690":[47,10],"691":[47,11],"692":[47,12],"693":[47,13],"694":[47,14],"695":[47,15],"696":[48,1],"697":[48,2],"698":[48,3],"699":[48,4],"700":[48,5],"701":[48,6],"702":[48,7],"703":[48,8],"704":[48,9],"705":[48,10],"706":[48,11],"707":[48,12],"708":[48,13],"709":[48,14],"710":[48,15],"711":[49,1],"712":[49,2],"713":[49,3],"714":[49,4],"715":[49,5],"716":[49,6],"717":[49,7],"718":[49,8],"719":[49,9],"720":[49,10],"721":[49,11],"722":[49,12],"723":[49,13],"724":[49,14],"725":[49,15],"726":[50,1],"727":[50,2],"728":[50,3],"729":[50,4],"730":[50,5],"731":[50,6],"732":[50,7],"733":[50,8],"734":[50,9],"735":[50,10],"736":[50,11],"737":[50,12],"738":[50,13],"739":[50,14],"740":[50,15],"741":[51,1],"742":[51,2],"743":[51,3],"744":[51,4],"745":[51,5],"746":[51,6],"747":[51,7],"748":[51,8],"749":[51,9],"750":[51,10],"751":[51,11],"752":[51,12],"753":[51,13],"754":[51,14],"755":[51,15],"756":[52,1],"757":[52,2],"758":[52,3],"759":[52,4],"760":[52,5],"761":[52,6],"762":[52,7],"763":[52,8],"764":[52,9],"765":[52,10],"766":[52,11],"767":[52,12],"768":[52,13],"769":[52,14],"770":[52,15],"771":[53,1],"772":[53,2],"773":[53,3],"774":[53,4],"775":[53,5],"776":[53,6],"777":[53,7],"778":[53,8],"779":[53,9],"780":[53,10],"781":[53,11],"782":[53,12],"783":[53,13],"784":[53,14],"785":[53,15],"786":[54,1],"787":[54,2],"788":[54,3],"789":[54,4],"790":[54,5],"791":[54,6],"792":[54,7],"793":[54,8],"794":[54,9],"795":[54,10],"796":[54,11],"797":[54,12],"798":[54,13],"799":[54,14],"800":[54,15],"801":[55,1],"802":[55,2],"803":[55,3],"804":[55,4],"805":[55,5],"806":[55,6],"807":[55,7],"808":[55,8],"809":[55,9],"810":[55,10],"811":[55,11],"812":[55,12],"813":[55,13],"814":[55,14],"815":[55,15],"816":[56,1],"817":[56,2],"818":[56,3],"819":[56,4],"820":[56,5],"821":[56,6],"822":[56,7],"823":[56,8],"824":[56,9],"825":[56,10],"826":[56,11],"827":[56,12],"828":[56,13],"829":[56,14],"830":[56,15],"831":[57,1],"832":[57,2],"833":[57,3],"834":[57,4],"835":[57,5],"836":[57,6],"837":[57,7],"838":[57,8],"839":[57,9],"840":[57,10],"841":[57,11],"842":[57,12],"843":[57,13],"844":[57,14],"845":[57,15],"846":[58,1],"847":[58,2],"848":[58,3],"849":[58,4],"850":[58,5],"851":[58,6],"852":[58,7],"853":[58,8],"854":[58,9],"855":[58,10],"856":[58,11],"857":[58,12],"858":[58,13],"859":[58,14],"860":[58,15],"861":[59,1],"862":[59,2],"863":[59,3],"864":[59,4],"865":[59,5],"866":[59,6],"867":[59,7],"868":[59,8],"869":[59,9],"870":[59,10],"871":[59,11],"872":[59,12],"873":[59,13],"874":[59,14],"875":[59,15],"876":[60,1],"877":[60,2],"878":[60,3],"879":[60,4],"880":[60,5],"881":[60,6],"882":[60,7],"883":[60,8],"884":[60,9],"885":[60,10],"886":[60,11],"887":[60,12],"888":[60,13],"889":[60,14],"890":[60,15],"891":[61,1],"892":[61,2],"893":[61,3],"894":[61,4],"895":[61,5],"896":[61,6],"897":[61,7],"898":[61,8],"899":[61,9],"900":[61,10],"901":[61,11],"902":[61,12],"903":[61,13],"904":[61,14],"905":[61,15],"906":[62,1],"907":[62,2],"908":[62,3],"909":[62,4],"910":[62,5],"911":[62,6],"912":[62,7],"913":[62,8],"914":[62,9],"915":[62,10],"916":[62,11],"917":[62,12],"918":[62,13],"919":[62,14],"920":[62,15],"921":[63,1],"922":[63,2],"923":[63,3],"924":[63,4],"925":[63,5],"926":[63,6],"927":[63,7],"928":[63,8],"929":[63,9],"930":[63,10],"931":[63,11],"932":[63,12],"933":[63,13],"934":[63,14],"935":[63,15],"936":[64,1],"937":[64,2],"938":[64,3],"939":[64,4],"940":[64,5],"941":[64,6],"942":[64,7],"943":[64,8],"944":[64,9],"945":[64,10],"946":[64,11],"947":[64,12],"948":[64,13],"949":[64,14],"950":[64,15],"951":[65,1],"952":[65,2],"953":[65,3],"954":[65,4],"955":[65,5],"956":[65,6],"957":[65,7],"958":[65,8],"959":[65,9],"960":[65,10],"961":[65,11],"962":[65,12],"963":[65,13],"964":[65,14],"965":[65,15],"966":[66,1],"967":[66,2],"968":[66,3],"969":[66,4],"970":[66,5],"971":[66,6],"972":[66,7],"973":[66,8],"974":[66,9],"975":[66,10],"976":[66,11],"977":[66,12],"978":[66,13],"979":[66,14],"980":[66,15],"981":[67,1],"982":[67,2],"983":[67,3],"984":[67,4],"985":[67,5],"986":[67,6],"987":[67,7],"988":[67,8],"989":[67,9],"990":[67,10],"991":[67,11],"992":[67,12],"993":[67,13],"994":[67,14],"995":[67,15],"996":[68,1],"997":[68,2],"998":[68,3],"999":[68,4],"1000":[68,5],"1001":[68,6],"1002":[68,7],"1003":[68,8],"1004":[68,9],"1005":[68,10],"1006":[68,11],"1007":[68,12],"1008":[68,13],"1009":[68,14],"1010":[68,15],"1011":[69,1],"1012":[69,2],"1013":[69,3],"1014":[69,4],"1015":[69,5],"1016":[69,6],"1017":[69,7],"1018":[69,8],"1019":[69,9],"1020":[69,10],"1021":[69,11],"1022":[69,12],"1023":[69,13],"1024":[69,14],"1025":[69,15],"1026":[70,1],"1027":[70,2],"1028":[70,3],"1029":[70,4],"1030":[70,5],"1031":[70,6],"1032":[70,7],"1033":[70,8],"1034":[70,9],"1035":[70,10],"1036":[70,11],"1037":[70,12],"1038":[70,13],"1039":[70,14],"1040":[70,15],"1041":[71,1],"1042":[71,2],"1043":[71,3],"1044":[71,4],"1045":[71,5],"1046":[71,6],"1047":[71,7],"1048":[71,8],"1049":[71,9],"1050":[71,10],"1051":[71,11],"1052":[71,12],"1053":[71,13],"1054":[71,14],"1055":[71,15],"1056":[72,1],"1057":[72,2],"1058":[72,3],"1059":[72,4],"1060":[72,5],"1061":[72,6],"1062":[72,7],"1063":[72,8],"1064":[72,9],"1065":[72,10],"1066":[72,11],"1067":[72,12],"1068":[72,13],"1069":[72,14],"1070":[72,15],"1071":[73,1],"1072":[73,2],"1073":[73,3],"1074":[73,4],"1075":[73,5],"1076":[73,6],"1077":[73,7],"1078":[73,8],"1079":[73,9],"1080":[73,10],"1081":[73,11],"1082":[73,12],"1083":[73,13],"1084":[73,14],"1085":[73,15],"1086":[74,1],"1087":[74,2],"1088":[74,3],"1089":[74,4],"1090":[74,5],"1091":[74,6],"1092":[74,7],"1093":[74,8],"1094":[74,9],"1095":[74,10],"1096":[74,11],"1097":[74,12],"1098":[74,13],"1099":[74,14],"1100":[74,15],"1101":[75,1],"1102":[75,2],"1103":[75,3],"1104":[75,4],"1105":[75,5],"1106":[75,6],"1107":[75,7],"1108":[75,8],"1109":[75,9],"1110":[75,10],"1111":[75,11],"1112":[75,12],"1113":[75,13],"1114":[75,14],"1115":[75,15],"1116":[76,1],"1117":[76,2],"1118":[76,3],"1119":[76,4],"1120":[76,5],"1121":[76,6],"1122":[76,7],"1123":[76,8],"1124":[76,9],"1125":[76,10],"1126":[76,11],"1127":[76,12],"1128":[76,13],"1129":[76,14],"1130":[76,15],"1131":[77,1],"1132":[77,2],"1133":[77,3],"1134":[77,4],"1135":[77,5],"1136":[77,6],"1137":[77,7],"1138":[77,8],"1139":[77,9],"1140":[77,10],"1141":[77,11],"1142":[77,12],"1143":[77,13],"1144":[77,14],"1145":[77,15],"1146":[78,1],"1147":[78,2],"1148":[78,3],"1149":[78,4],"1150":[78,5],"1151":[78,6],"1152":[78,7],"1153":[78,8],"1154":[78,9],"1155":[78,10],"1156":[78,11],"1157":[78,12],"1158":[78,13],"1159":[78,14],"1160":[78,15],"1161":[79,1],"1162":[79,2],"1163":[79,3],"1164":[79,4],"1165":[79,5],"1166":[79,6],"1167":[79,7],"1168":[79,8],"1169":[79,9],"1170":[79,10],"1171":[79,11],"1172":[79,12],"1173":[79,13],"1174":[79,14],"1175":[79,15],"1176":[80,1],"1177":[80,2],"1178":[80,3],"1179":[80,4],"1180":[80,5],"1181":[80,6],"1182":[80,7],"1183":[80,8],"1184":[80,9],"1185":[80,10],"1186":[80,11],"1187":[80,12],"1188":[80,13],"1189":[80,14],"1190":[80,15],"1191":[81,1],"1192":[81,2],"1193":[81,3],"1194":[81,4],"1195":[81,5],"1196":[81,6],"1197":[81,7],"1198":[81,8],"1199":[81,9],"1200":[81,10],"1201":[81,11],"1202":[81,12],"1203":[81,13],"1204":[81,14],"1205":[81,15],"1206":[82,1],"1207":[82,2],"1208":[82,3],"1209":[82,4],"1210":[82,5],"1211":[82,6],"1212":[82,7],"1213":[82,8],"1214":[82,9],"1215":[82,10],"1216":[82,11],"1217":[82,12],"1218":[82,13],"1219":[82,14],"1220":[82,15],"1221":[83,1],"1222":[83,2],"1223":[83,3],"1224":[83,4],"1225":[83,5],"1226":[83,6],"1227":[83,7],"1228":[83,8],"1229":[83,9],"1230":[83,10],"1231":[83,11],"1232":[83,12],"1233":[83,13],"1234":[83,14],"1235":[83,15],"1236":[84,1],"1237":[84,2],"1238":[84,3],"1239":[84,4],"1240":[84,5],"1241":[84,6],"1242":[84,7],"1243":[84,8],"1244":[84,9],"1245":[84,10],"1246":[84,11],"1247":[84,12],"1248":[84,13],"1249":[84,14],"1250":[84,15],"1251":[85,1],"1252":[85,2],"1253":[85,3],"1254":[85,4],"1255":[85,5],"1256":[85,6],"1257":[85,7],"1258":[85,8],"1259":[85,9],"1260":[85,10],"1261":[85,11],"1262":[85,12],"1263":[85,13],"1264":[85,14],"1265":[85,15],"1266":[86,1],"1267":[86,2],"1268":[86,3],"1269":[86,4],"1270":[86,5],"1271":[86,6],"1272":[86,7],"1273":[86,8],"1274":[86,9],"1275":[86,10],"1276":[86,11],"1277":[86,12],"1278":[86,13],"1279":[86,14],"1280":[86,15],"1281":[87,1],"1282":[87,2],"1283":[87,3],"1284":[87,4],"1285":[87,5],"1286":[87,6],"1287":[87,7],"1288":[87,8],"1289":[87,9],"1290":[87,10],"1291":[87,11],"1292":[87,12],"1293":[87,13],"1294":[87,14],"1295":[87,15],"1296":[88,1],"1297":[88,2],"1298":[88,3],"1299":[88,4],"1300":[88,5],"1301":[88,6],"1302":[88,7],"1303":[88,8],"1304":[88,9],"1305":[88,10],"1306":[88,11],"1307":[88,12],"1308":[88,13],"1309":[88,14],"1310":[88,15],"1311":[89,1],"1312":[89,2],"1313":[89,3],"1314":[89,4],"1315":[89,5],"1316":[89,6],"1317":[89,7],"1318":[89,8],"1319":[89,9],"1320":[89,10],"1321":[89,11],"1322":[89,12],"1323":[89,13],"1324":[89,14],"1325":[89,15],"1326":[90,1],"1327":[90,2],"1328":[90,3],"1329":[90,4],"1330":[90,5],"1331":[90,6],"1332":[90,7],"1333":[90,8],"1334":[90,9],"1335":[90,10],"1336":[90,11],"1337":[90,12],"1338":[90,13],"1339":[90,14],"1340":[90,15],"1341":[91,1],"1342":[91,2],"1343":[91,3],"1344":[91,4],"1345":[91,5],"1346":[91,6],"1347":[91,7],"1348":[91,8],"1349":[91,9],"1350":[91,10],"1351":[91,11],"1352":[91,12],"1353":[91,13],"1354":[91,14],"1355":[91,15],"1356":[92,1],"1357":[92,2],"1358":[92,3],"1359":[92,4],"1360":[92,5],"1361":[92,6],"1362":[92,7],"1363":[92,8],"1364":[92,9],"1365":[92,10],"1366":[92,11],"1367":[92,12],"1368":[92,13],"1369":[92,14],"1370":[92,15],"1371":[93,1],"1372":[93,2],"1373":[93,3],"1374":[93,4],"1375":[93,5],"1376":[93,6],"1377":[93,7],"1378":[93,8],"1379":[93,9],"1380":[93,10],"1381":[93,11],"1382":[93,12],"1383":[93,13],"1384":[93,14],"1385":[93,15],"1386":[94,1],"1387":[94,2],"1388":[94,3],"1389":[94,4],"1390":[94,5],"1391":[94,6],"1392":[94,7],"1393":[94,8],"1394":[94,9],"1395":[94,10],"1396":[94,11],"1397":[94,12],"1398":[94,13],"1399":[94,14],"1400":[94,15],"1401":[95,1],"1402":[95,2],"1403":[95,3],"1404":[95,4],"1405":[95,5],"1406":[95,6],"1407":[95,7],"1408":[95,8],"1409":[95,9],"1410":[95,10],"1411":[95,11],"1412":[95,12],"1413":[95,13],"1414":[95,14],"1415":[95,15],"1416":[96,1],"1417":[96,2],"1418":[96,3],"1419":[96,4],"1420":[96,5],"1421":[96,6],"1422":[96,7],"1423":[96,8],"1424":[96,9],"1425":[96,10],"1426":[96,11],"1427":[96,12],"1428":[96,13],"1429":[96,14],"1430":[96,15],"1431":[97,1],"1432":[97,2],"1433":[97,3],"1434":[97,4],"1435":[97,5],"1436":[97,6],"1437":[97,7],"1438":[97,8],"1439":[97,9],"1440":[97,10],"1441":[97,11],"1442":[97,12],"1443":[97,13],"1444":[97,14],"1445":[97,15],"1446":[98,1],"1447":[98,2],"1448":[98,3],"1449":[98,4],"1450":[98,5],"1451":[98,6],"1452":[98,7],"1453":[98,8],"1454":[98,9],"1455":[98,10],"1456":[98,11],"1457":[98,12],"1458":[98,13],"1459":[98,14],"1460":[98,15],"1461":[99,1],"1462":[99,2],"1463":[99,3],"1464":[99,4],"1465":[99,5],"1466":[99,6],"1467":[99,7],"1468":[99,8],"1469":[99,9],"1470":[99,10],"1471":[99,11],"1472":[99,12],"1473":[99,13],"1474":[99,14],"1475":[99,15],"1476":[100,1],"1477":[100,2],"1478":[100,3],"1479":[100,4],"1480":[100,5],"1481":[100,6],"1482":[100,7],"1483":[100,8],"1484":[100,9],"1485":[100,10],"1486":[100,11],"1487":[100,12],"1488":[100,13],"1489":[100,14],"1490":[100,15],"1491":[101,1],"1492":[101,2],"1493":[101,3],"1494":[101,4],"1495":[101,5],"1496":[101,6],"1497":[101,7],"1498":[101,8],"1499":[101,9],"1500":[101,10],"1501":[101,11],"1502":[101,12],"1503":[101,13],"1504":[101,14],"1505":[101,15],"1506":[102,1],"1507":[102,2],"1508":[102,3],"1509":[102,4],"1510":[102,5],"1511":[102,6],"1512":[102,7],"1513":[102,8],"1514":[102,9],"1515":[102,10],"1516":[102,11],"1517":[102,12],"1518":[102,13],"1519":[102,14],"1520":[102,15],"1521":[103,1],"1522":[103,2],"1523":[103,3],"1524":[103,4],"1525":[103,5],"1526":[103,6],"1527":[103,7],"1528":[103,8],"1529":[103,9],"1530":[103,10],"1531":[103,11],"1532":[103,12],"1533":[103,13],"1534":[103,14],"1535":[103,15],"1536":[104,1],"1537":[104,2],"1538":[104,3],"1539":[104,4],"1540":[104,5],"1541":[104,6],"1542":[104,7],"1543":[104,8],"1544":[104,9],"1545":[104,10],"1546":[104,11],"1547":[104,12],"1548":[104,13],"1549":[104,14],"1550":[104,15],"1551":[105,1],"1552":[105,2],"1553":[105,3],"1554":[105,4],"1555":[105,5],"1556":[105,6],"1557":[105,7],"1558":[105,8],"1559":[105,9],"1560":[105,10],"1561":[105,11],"1562":[105,12],"1563":[105,13],"1564":[105,14],"1565":[105,15],"1566":[106,1],"1567":[106,2],"1568":[106,3],"1569":[106,4],"1570":[106,5],"1571":[106,6],"1572":[106,7],"1573":[106,8],"1574":[106,9],"1575":[106,10],"1576":[106,11],"1577":[106,12],"1578":[106,13],"1579":[106,14],"1580":[106,15],"1581":[107,1],"1582":[107,2],"1583":[107,3],"1584":[107,4],"1585":[107,5],"1586":[107,6],"1587":[107,7],"1588":[107,8],"1589":[107,9],"1590":[107,10],"1591":[107,11],"1592":[107,12],"1593":[107,13],"1594":[107,14],"1595":[107,15],"1596":[108,1],"1597":[108,2],"1598":[108,3],"1599":[108,4],"1600":[108,5],"1601":[108,6],"1602":[108,7],"1603":[108,8],"1604":[108,9],"1605":[108,10],"1606":[108,11],"1607":[108,12],"1608":[108,13],"1609":[108,14],"1610":[108,15],"1611":[109,1],"1612":[109,2],"1613":[109,3],"1614":[109,4],"1615":[109,5],"1616":[109,6],"1617":[109,7],"1618":[109,8],"1619":[109,9],"1620":[109,10],"1621":[109,11],"1622":[109,12],"1623":[109,13],"1624":[109,14],"1625":[109,15],"1626":[110,1],"1627":[110,2],"1628":[110,3],"1629":[110,4],"1630":[110,5],"1631":[110,6],"1632":[110,7],"1633":[110,8],"1634":[110,9],"1635":[110,10],"1636":[110,11],"1637":[110,12],"1638":[110,13],"1639":[110,14],"1640":[110,15],"1641":[111,1],"1642":[111,2],"1643":[111,3],"1644":[111,4],"1645":[111,5],"1646":[111,6],"1647":[111,7],"1648":[111,8],"1649":[111,9],"1650":[111,10],"1651":[111,11],"1652":[111,12],"1653":[111,13],"1654":[111,14],"1655":[111,15],"1656":[112,1],"1657":[112,2],"1658":[112,3],"1659":[112,4],"1660":[112,5],"1661":[112,6],"1662":[112,7],"1663":[112,8],"1664":[112,9],"1665":[112,10],"1666":[112,11],"1667":[112,12],"1668":[112,13],"1669":[112,14],"1670":[112,15],"1671":[113,1],"1672":[113,2],"1673":[113,3],"1674":[113,4],"1675":[113,5],"1676":[113,6],"1677":[113,7],"1678":[113,8],"1679":[113,9],"1680":[113,10],"1681":[113,11],"1682":[113,12],"1683":[113,13],"1684":[113,14],"1685":[113,15],"1686":[114,1],"1687":[114,2],"1688":[114,3],"1689":[114,4],"1690":[114,5],"1691":[114,6],"1692":[114,7],"1693":[114,8],"1694":[114,9],"1695":[114,10],"1696":[114,11],"1697":[114,12],"1698":[114,13],"1699":[114,14],"1700":[114,15],"1701":[115,1],"1702":[115,2],"1703":[115,3],"1704":[115,4],"1705":[115,5],"1706":[115,6],"1707":[115,7],"1708":[115,8],"1709":[115,9],"1710":[115,10],"1711":[115,11],"1712":[115,12],"1713":[115,13],"1714":[115,14],"1715":[115,15],"1716":[116,1],"1717":[116,2],"1718":[116,3],"1719":[116,4],"1720":[116,5],"1721":[116,6],"1722":[116,7],"1723":[116,8],"1724":[116,9],"1725":[116,10],"1726":[116,11],"1727":[116,12],"1728":[116,13],"1729":[116,14],"1730":[116,15],"1731":[117,1],"1732":[117,2],"1733":[117,3],"1734":[117,4],"1735":[117,5],"1736":[117,6],"1737":[117,7],"1738":[117,8],"1739":[117,9],"1740":[117,10],"1741":[117,11],"1742":[117,12],"1743":[117,13],"1744":[117,14],"1745":[117,15],"1746":[118,1],"1747":[118,2],"1748":[118,3],"1749":[118,4],"1750":[118,5],"1751":[118,6],"1752":[118,7],"1753":[118,8],"1754":[118,9],"1755":[118,10],"1756":[118,11],"1757":[118,12],"1758":[118,13],"1759":[118,14],"1760":[118,15],"1761":[119,1],"1762":[119,2],"1763":[119,3],"1764":[119,4],"1765":[119,5],"1766":[119,6],"1767":[119,7],"1768":[119,8],"1769":[119,9],"1770":[119,10],"1771":[119,11],"1772":[119,12],"1773":[119,13],"1774":[119,14],"1775":[119,15],"1776":[120,1],"1777":[120,2],"1778":[120,3],"1779":[120,4],"1780":[120,5],"1781":[120,6],"1782":[120,7],"1783":[120,8],"1784":[120,9],"1785":[120,10],"1786":[120,11],"1787":[120,12],"1788":[120,13],"1789":[120,14],"1790":[120,15],"1791":[121,1],"1792":[121,2],"1793":[121,3],"1794":[121,4],"1795":[121,5],"1796":[121,6],"1797":[121,7],"1798":[121,8],"1799":[121,9],"1800":[121,10],"1801":[121,11],"1802":[121,12],"1803":[121,13],"1804":[121,14],"1805":[121,15],"1806":[122,1],"1807":[122,2],"1808":[122,3],"1809":[122,4],"1810":[122,5],"1811":[122,6],"1812":[122,7],"1813":[122,8],"1814":[122,9],"1815":[122,10],"1816":[122,11],"1817":[122,12],"1818":[122,13],"1819":[122,14],"1820":[122,15],"1821":[123,1],"1822":[123,2],"1823":[123,3],"1824":[123,4],"1825":[123,5],"1826":[123,6],"1827":[123,7],"1828":[123,8],"1829":[123,9],"1830":[123,10],"1831":[123,11],"1832":[123,12],"1833":[123,13],"1834":[123,14],"1835":[123,15],"1836":[124,1],"1837":[124,2],"1838":[124,3],"1839":[124,4],"1840":[124,5],"1841":[124,6],"1842":[124,7],"1843":[124,8],"1844":[124,9],"1845":[124,10],"1846":[124,11],"1847":[124,12],"1848":[124,13],"1849":[124,14],"1850":[124,15],"1851":[125,1],"1852":[125,2],"1853":[125,3],"1854":[125,4],"1855":[125,5],"1856":[125,6],"1857":[125,7],"1858":[125,8],"1859":[125,9],"1860":[125,10],"1861":[125,11],"1862":[125,12],"1863":[125,13],"1864":[125,14],"1865":[125,15],"1866":[126,1],"1867":[126,2],"1868":[126,3],"1869":[126,4],"1870":[126,5],"1871":[126,6],"1872":[126,7],"1873":[126,8],"1874":[126,9],"1875":[126,10],"1876":[126,11],"1877":[126,12],"1878":[126,13],"1879":[126,14],"1880":[126,15],"1881":[127,1],"1882":[127,2],"1883":[127,3],"1884":[127,4],"1885":[127,5],"1886":[127,6],"1887":[127,7],"1888":[127,8],"1889":[127,9],"1890":[127,10],"1891":[127,11],"1892":[127,12],"1893":[127,13],"1894":[127,14],"1895":[127,15],"1896":[128,1],"1897":[128,2],"1898":[128,3],"1899":[128,4],"1900":[128,5],"1901":[128,6],"1902":[128,7],"1903":[128,8],"1904":[128,9],"1905":[128,10],"1906":[128,11],"1907":[128,12],"1908":[128,13],"1909":[128,14],"1910":[128,15],"1911":[129,1],"1912":[129,2],"1913":[129,3],"1914":[129,4],"1915":[129,5],"1916":[129,6],"1917":[129,7],"1918":[129,8],"1919":[129,9],"1920":[129,10],"1921":[129,11],"1922":[129,12],"1923":[129,13],"1924":[129,14],"1925":[129,15],"1926":[130,1],"1927":[130,2],"1928":[130,3],"1929":[130,4],"1930":[130,5],"1931":[130,6],"1932":[130,7],"1933":[130,8],"1934":[130,9],"1935":[130,10],"1936":[130,11],"1937":[130,12],"1938":[130,13],"1939":[130,14],"1940":[130,15],"1941":[131,1],"1942":[131,2],"1943":[131,3],"1944":[131,4],"1945":[131,5],"1946":[131,6],"1947":[131,7],"1948":[131,8],"1949":[131,9],"1950":[131,10],"1951":[131,11],"1952":[131,12],"1953":[131,13],"1954":[131,14],"1955":[131,15],"1956":[132,1],"1957":[132,2],"1958":[132,3],"1959":[132,4],"1960":[132,5],"1961":[132,6],"1962":[132,7],"1963":[132,8],"1964":[132,9],"1965":[132,10],"1966":[132,11],"1967":[132,12],"1968":[132,13],"1969":[132,14],"1970":[132,15],"1971":[133,1],"1972":[133,2],"1973":[133,3],"1974":[133,4],"1975":[133,5],"1976":[133,6],"1977":[133,7],"1978":[133,8],"1979":[133,9],"1980":[133,10],"1981":[133,11],"1982":[133,12],"1983":[133,13],"1984":[133,14],"1985":[133,15],"1986":[134,1],"1987":[134,2],"1988":[134,3],"1989":[134,4],"1990":[134,5],"1991":[134,6],"1992":[134,7],"1993":[134,8],"1994":[134,9],"1995":[134,10],"1996":[134,11],"1997":[134,12],"1998":[134,13],"1999":[134,14],"2000":[134,15],"2001":[135,1],"2002":[135,2],"2003":[135,3],"2004":[135,4],"2005":[135,5],"2006":[135,6],"2007":[135,7],"2008":[135,8],"2009":[135,9],"2010":[135,10],"2011":[135,11],"2012":[135,12],"2013":[135,13],"2014":[135,14],"2015":[135,15],"2016":[136,1],"2017":[136,2],"2018":[136,3],"2019":[136,4],"2020":[136,5],"2021":[136,6],"2022":[136,7],"2023":[136,8],"2024":[136,9],"2025":[136,10],"2026":[136,11],"2027":[136,12],"2028":[136,13],"2029":[136,14],"2030":[136,15],"2031":[137,1],"2032":[137,2],"2033":[137,3],"2034":[137,4],"2035":[137,5],"2036":[137,6],"2037":[137,7],"2038":[137,8],"2039":[137,9],"2040":[137,10],"2041":[137,11],"2042":[137,12],"2043":[137,13],"2044":[137,14],"2045":[137,15],"2046":[138,1],"2047":[138,2],"2048":[138,3],"2049":[138,4],"2050":[138,5],"2051":[138,6],"2052":[138,7],"2053":[138,8],"2054":[138,9],"2055":[138,10],"2056":[138,11],"2057":[138,12],"2058":[138,13],"2059":[138,14],"2060":[138,15],"2061":[139,1],"2062":[139,2],"2063":[139,3],"2064":[139,4],"2065":[139,5],"2066":[139,6],"2067":[139,7],"2068":[139,8],"2069":[139,9],"2070":[139,10],"2071":[139,11],"2072":[139,12],"2073":[139,13],"2074":[139,14],"2075":[139,15],"2076":[140,1],"2077":[140,2],"2078":[140,3],"2079":[140,4],"2080":[140,5],"2081":[140,6],"2082":[140,7],"2083":[140,8],"2084":[140,9],"2085":[140,10],"2086":[140,11],"2087":[140,12],"2088":[140,13],"2089":[140,14],"2090":[140,15],"2091":[141,1],"2092":[141,2],"2093":[141,3],"2094":[141,4],"2095":[141,5],"2096":[141,6],"2097":[141,7],"2098":[141,8],"2099":[141,9],"2100":[141,10],"2101":[141,11],"2102":[141,12],"2103":[141,13],"2104":[141,14],"2105":[141,15],"2106":[142,1],"2107":[142,2],"2108":[142,3],"2109":[142,4],"2110":[142,5],"2111":[142,6],"2112":[142,7],"2113":[142,8],"2114":[142,9],"2115":[142,10],"2116":[142,11],"2117":[142,12],"2118":[142,13],"2119":[142,14],"2120":[142,15],"2121":[143,1],"2122":[143,2],"2123":[143,3],"2124":[143,4],"2125":[143,5],"2126":[143,6],"2127":[143,7],"2128":[143,8],"2129":[143,9],"2130":[143,10],"2131":[143,11],"2132":[143,12],"2133":[143,13],"2134":[143,14],"2135":[143,15],"2136":[144,1],"2137":[144,2],"2138":[144,3],"2139":[144,4],"2140":[144,5],"2141":[144,6],"2142":[144,7],"2143":[144,8],"2144":[144,9],"2145":[144,10],"2146":[144,11],"2147":[144,12],"2148":[144,13],"2149":[144,14],"2150":[144,15],"2151":[145,1],"2152":[145,2],"2153":[145,3],"2154":[145,4],"2155":[145,5],"2156":[145,6],"2157":[145,7],"2158":[145,8],"2159":[145,9],"2160":[145,10],"2161":[145,11],"2162":[145,12],"2163":[145,13],"2164":[145,14],"2165":[145,15],"2166":[146,1],"2167":[146,2],"2168":[146,3],"2169":[146,4],"2170":[146,5],"2171":[146,6],"2172":[146,7],"2173":[146,8],"2174":[146,9],"2175":[146,10],"2176":[146,11],"2177":[146,12],"2178":[146,13],"2179":[146,14],"2180":[146,15],"2181":[147,1],"2182":[147,2],"2183":[147,3],"2184":[147,4],"2185":[147,5],"2186":[147,6],"2187":[147,7],"2188":[147,8],"2189":[147,9],"2190":[147,10],"2191":[147,11],"2192":[147,12],"2193":[147,13],"2194":[147,14],"2195":[147,15],"2196":[148,1],"2197":[148,2],"2198":[148,3],"2199":[148,4],"2200":[148,5],"2201":[148,6],"2202":[148,7],"2203":[148,8],"2204":[148,9],"2205":[148,10],"2206":[148,11],"2207":[148,12],"2208":[148,13],"2209":[148,14],"2210":[148,15],"2211":[149,1],"2212":[149,2],"2213":[149,3],"2214":[149,4],"2215":[149,5],"2216":[149,6],"2217":[149,7],"2218":[149,8],"2219":[149,9],"2220":[149,10],"2221":[149,11],"2222":[149,12],"2223":[149,13],"2224":[149,14],"2225":[149,15],"2226":[150,1],"2227":[150,2],"2228":[150,3],"2229":[150,4],"2230":[150,5],"2231":[150,6],"2232":[150,7],"2233":[150,8],"2234":[150,9],"2235":[150,10],"2236":[150,11],"2237":[150,12],"2238":[150,13],"2239":[150,14],"2240":[150,15],"2241":[151,1],"2242":[151,2],"2243":[151,3],"2244":[151,4],"2245":[151,5],"2246":[151,6],"2247":[151,7],"2248":[151,8],"2249":[151,9],"2250":[151,10],"2251":[151,11],"2252":[151,12],"2253":[151,13],"2254":[151,14],"2255":[151,15],"2256":[152,1],"2257":[152,2],"2258":[152,3],"2259":[152,4],"2260":[152,5],"2261":[152,6],"2262":[152,7],"2263":[152,8],"2264":[152,9],"2265":[152,10],"2266":[152,11],"2267":[152,12],"2268":[152,13],"2269":[152,14],"2270":[152,15],"2271":[153,1],"2272":[153,2],"2273":[153,3],"2274":[153,4],"2275":[153,5],"2276":[153,6],"2277":[153,7],"2278":[153,8],"2279":[153,9],"2280":[153,10],"2281":[153,11],"2282":[153,12],"2283":[153,13],"2284":[153,14],"2285":[153,15],"2286":[154,1],"2287":[154,2],"2288":[154,3],"2289":[154,4],"2290":[154,5],"2291":[154,6],"2292":[154,7],"2293":[154,8],"2294":[154,9],"2295":[154,10],"2296":[154,11],"2297":[154,12],"2298":[154,13],"2299":[154,14],"2300":[154,15],"2301":[155,1],"2302":[155,2],"2303":[155,3],"2304":[155,4],"2305":[155,5],"2306":[155,6],"2307":[155,7],"2308":[155,8],"2309":[155,9],"2310":[155,10],"2311":[155,11],"2312":[155,12],"2313":[155,13],"2314":[155,14],"2315":[155,15],"2316":[156,1],"2317":[156,2],"2318":[156,3],"2319":[156,4],"2320":[156,5],"2321":[156,6],"2322":[156,7],"2323":[156,8],"2324":[156,9],"2325":[156,10],"2326":[156,11],"2327":[156,12],"2328":[156,13],"2329":[156,14],"2330":[156,15],"2331":[157,1],"2332":[157,2],"2333":[157,3],"2334":[157,4],"2335":[157,5],"2336":[157,6],"2337":[157,7],"2338":[157,8],"2339":[157,9],"2340":[157,10],"2341":[157,11],"2342":[157,12],"2343":[157,13],"2344":[157,14],"2345":[157,15],"2346":[158,1],"2347":[158,2],"2348":[158,3],"2349":[158,4],"2350":[158,5],"2351":[158,6],"2352":[158,7],"2353":[158,8],"2354":[158,9],"2355":[158,10],"2356":[158,11],"2357":[158,12],"2358":[158,13],"2359":[158,14],"2360":[158,15],"2361":[159,1],"2362":[159,2],"2363":[159,3],"2364":[159,4],"2365":[159,5],"2366":[159,6],"2367":[159,7],"2368":[159,8],"2369":[159,9],"2370":[159,10],"2371":[159,11],"2372":[159,12],"2373":[159,13],"2374":[159,14],"2375":[159,15],"2376":[160,1],"2377":[160,2],"2378":[160,3],"2379":[160,4],"2380":[160,5],"2381":[160,6],"2382":[160,7],"2383":[160,8],"2384":[160,9],"2385":[160,10],"2386":[160,11],"2387":[160,12],"2388":[160,13],"2389":[160,14],"2390":[160,15],"2391":[161,1],"2392":[161,2],"2393":[161,3],"2394":[161,4],"2395":[161,5],"2396":[161,6],"2397":[161,7],"2398":[161,8],"2399":[161,9],"2400":[161,10],"2401":[161,11],"2402":[161,12],"2403":[161,13],"2404":[161,14],"2405":[161,15],"2406":[162,1],"2407":[162,2],"2408":[162,3],"2409":[162,4],"2410":[162,5],"2411":[162,6],"2412":[162,7],"2413":[162,8],"2414":[162,9],"2415":[162,10],"2416":[162,11],"2417":[162,12],"2418":[162,13],"2419":[162,14],"2420":[162,15],"2421":[163,1],"2422":[163,2],"2423":[163,3],"2424":[163,4],"2425":[163,5],"2426":[163,6],"2427":[163,7],"2428":[163,8],"2429":[163,9],"2430":[163,10],"2431":[163,11],"2432":[163,12],"2433":[163,13],"2434":[163,14],"2435":[163,15],"2436":[164,1],"2437":[164,2],"2438":[164,3],"2439":[164,4],"2440":[164,5],"2441":[164,6],"2442":[164,7],"2443":[164,8],"2444":[164,9],"2445":[164,10],"2446":[164,11],"2447":[164,12],"2448":[164,13],"2449":[164,14],"2450":[164,15],"2451":[165,1],"2452":[165,2],"2453":[165,3],"2454":[165,4],"2455":[165,5],"2456":[165,6],"2457":[165,7],"2458":[165,8],"2459":[165,9],"2460":[165,10],"2461":[165,11],"2462":[165,12],"2463":[165,13],"2464":[165,14],"2465":[165,15],"2466":[166,1],"2467":[166,2],"2468":[166,3],"2469":[166,4],"2470":[166,5],"2471":[166,6],"2472":[166,7],"2473":[166,8],"2474":[166,9],"2475":[166,10],"2476":[166,11],"2477":[166,12],"2478":[166,13],"2479":[166,14],"2480":[166,15],"2481":[167,1],"2482":[167,2],"2483":[167,3],"2484":[167,4],"2485":[167,5],"2486":[167,6],"2487":[167,7],"2488":[167,8],"2489":[167,9],"2490":[167,10],"2491":[167,11],"2492":[167,12],"2493":[167,13],"2494":[167,14],"2495":[167,15],"2496":[168,1],"2497":[168,2],"2498":[168,3],"2499":[168,4],"2500":[168,5],"2501":[168,6],"2502":[168,7],"2503":[168,8],"2504":[168,9],"2505":[168,10],"2506":[168,11],"2507":[168,12],"2508":[168,13],"2509":[168,14],"2510":[168,15],"2511":[169,1],"2512":[169,2],"2513":[169,3],"2514":[169,4],"2515":[169,5],"2516":[169,6],"2517":[169,7],"2518":[169,8],"2519":[169,9],"2520":[169,10],"2521":[169,11],"2522":[169,12],"2523":[169,13],"2524":[169,14],"2525":[169,15],"2526":[170,1],"2527":[170,2],"2528":[170,3],"2529":[170,4],"2530":[170,5],"2531":[170,6],"2532":[170,7],"2533":[170,8],"2534":[170,9],"2535":[170,10],"2536":[170,11],"2537":[170,12],"2538":[170,13],"2539":[170,14],"2540":[170,15],"2541":[171,1],"2542":[171,2],"2543":[171,3],"2544":[171,4],"2545":[171,5],"2546":[171,6],"2547":[171,7],"2548":[171,8],"2549":[171,9],"2550":[171,10],"2551":[171,11],"2552":[171,12],"2553":[171,13],"2554":[171,14],"2555":[171,15],"2556":[172,1],"2557":[172,2],"2558":[172,3],"2559":[172,4],"2560":[172,5],"2561":[172,6],"2562":[172,7],"2563":[172,8],"2564":[172,9],"2565":[172,10],"2566":[172,11],"2567":[172,12],"2568":[172,13],"2569":[172,14],"2570":[172,15],"2571":[173,1],"2572":[173,2],"2573":[173,3],"2574":[173,4],"2575":[173,5],"2576":[173,6],"2577":[173,7],"2578":[173,8],"2579":[173,9],"2580":[173,10],"2581":[173,11],"2582":[173,12],"2583":[173,13],"2584":[173,14],"2585":[173,15],"2586":[174,1],"2587":[174,2],"2588":[174,3],"2589":[174,4],"2590":[174,5],"2591":[174,6],"2592":[174,7],"2593":[174,8],"2594":[174,9],"2595":[174,10],"2596":[174,11],"2597":[174,12],"2598":[174,13],"2599":[174,14],"2600":[174,15],"2601":[175,1],"2602":[175,2],"2603":[175,3],"2604":[175,4],"2605":[175,5],"2606":[175,6],"2607":[175,7],"2608":[175,8],"2609":[175,9],"2610":[175,10],"2611":[175,11],"2612":[175,12],"2613":[175,13],"2614":[175,14],"2615":[175,15],"2616":[176,1],"2617":[176,2],"2618":[176,3],"2619":[176,4],"2620":[176,5],"2621":[176,6],"2622":[176,7],"2623":[176,8],"2624":[176,9],"2625":[176,10],"2626":[176,11],"2627":[176,12],"2628":[176,13],"2629":[176,14],"2630":[176,15],"2631":[177,1],"2632":[177,2],"2633":[177,3],"2634":[177,4],"2635":[177,5],"2636":[177,6],"2637":[177,7],"2638":[177,8],"2639":[177,9],"2640":[177,10],"2641":[177,11],"2642":[177,12],"2643":[177,13],"2644":[177,14],"2645":[177,15],"2646":[178,1],"2647":[178,2],"2648":[178,3],"2649":[178,4],"2650":[178,5],"2651":[178,6],"2652":[178,7],"2653":[178,8],"2654":[178,9],"2655":[178,10],"2656":[178,11],"2657":[178,12],"2658":[178,13],"2659":[178,14],"2660":[178,15],"2661":[179,1],"2662":[179,2],"2663":[179,3],"2664":[179,4],"2665":[179,5],"2666":[179,6],"2667":[179,7],"2668":[179,8],"2669":[179,9],"2670":[179,10],"2671":[179,11],"2672":[179,12],"2673":[179,13],"2674":[179,14],"2675":[179,15],"2676":[180,1],"2677":[180,2],"2678":[180,3],"2679":[180,4],"2680":[180,5],"2681":[180,6],"2682":[180,7],"2683":[180,8],"2684":[180,9],"2685":[180,10],"2686":[180,11],"2687":[180,12],"2688":[180,13],"2689":[180,14],"2690":[180,15],"2691":[181,1],"2692":[181,2],"2693":[181,3],"2694":[181,4],"2695":[181,5],"2696":[181,6],"2697":[181,7],"2698":[181,8],"2699":[181,9],"2700":[181,10],"2701":[181,11],"2702":[181,12],"2703":[181,13],"2704":[181,14],"2705":[181,15],"2706":[182,1],"2707":[182,2],"2708":[182,3],"2709":[182,4],"2710":[182,5],"2711":[182,6],"2712":[182,7],"2713":[182,8],"2714":[182,9],"2715":[182,10],"2716":[182,11],"2717":[182,12],"2718":[182,13],"2719":[182,14],"2720":[182,15],"2721":[183,1],"2722":[183,2],"2723":[183,3],"2724":[183,4],"2725":[183,5],"2726":[183,6],"2727":[183,7],"2728":[183,8],"2729":[183,9],"2730":[183,10],"2731":[183,11],"2732":[183,12],"2733":[183,13],"2734":[183,14],"2735":[183,15],"2736":[184,1],"2737":[184,2],"2738":[184,3],"2739":[184,4],"2740":[184,5],"2741":[184,6],"2742":[184,7],"2743":[184,8],"2744":[184,9],"2745":[184,10],"2746":[184,11],"2747":[184,12],"2748":[184,13],"2749":[184,14],"2750":[184,15],"2751":[185,1],"2752":[185,2],"2753":[185,3],"2754":[185,4],"2755":[185,5],"2756":[185,6],"2757":[185,7],"2758":[185,8],"2759":[185,9],"2760":[185,10],"2761":[185,11],"2762":[185,12],"2763":[185,13],"2764":[185,14],"2765":[185,15],"2766":[186,1],"2767":[186,2],"2768":[186,3],"2769":[186,4],"2770":[186,5],"2771":[186,6],"2772":[186,7],"2773":[186,8],"2774":[186,9],"2775":[186,10],"2776":[186,11],"2777":[186,12],"2778":[186,13],"2779":[186,14],"2780":[186,15],"2781":[187,1],"2782":[187,2],"2783":[187,3],"2784":[187,4],"2785":[187,5],"2786":[187,6],"2787":[187,7],"2788":[187,8],"2789":[187,9],"2790":[187,10],"2791":[187,11],"2792":[187,12],"2793":[187,13],"2794":[187,14],"2795":[187,15],"2796":[188,1],"2797":[188,2],"2798":[188,3],"2799":[188,4],"2800":[188,5],"2801":[188,6],"2802":[188,7],"2803":[188,8],"2804":[188,9],"2805":[188,10],"2806":[188,11],"2807":[188,12],"2808":[188,13],"2809":[188,14],"2810":[188,15],"2811":[189,1],"2812":[189,2],"2813":[189,3],"2814":[189,4],"2815":[189,5],"2816":[189,6],"2817":[189,7],"2818":[189,8],"2819":[189,9],"2820":[189,10],"2821":[189,11],"2822":[189,12],"2823":[189,13],"2824":[189,14],"2825":[189,15],"2826":[1201,1]};

function getUserUniverse() {
    let data = get('userUniverse_' + currentProfile);
    if (!data) {
        data = {
            "episodes": initialEpisodes,
            "unlockedItems": []
          }
        set('userUniverse_' + currentProfile, data);
    }

    data.episodes.sort(function(a,b) {return a.id - b.id})
    return data
}

function gameStart(episode, level) {
    // this is to make lives go down by 1
    let data = get('currentUser_' + currentProfile)
    calcLives(data)
    data.lives--
    if (data.timeToNextRegeneration == -1000) {
        data.timeToNextRegeneration = 1800000
        data.timeStampLastLivesCheck = Date.now()
    }
    calcLives(data)

    let res = {
        currentUser: getCurrentUser(),
        recommendedSeeds: [],
        levelData: loadedLevels[episode][level].gameData//loadedLevels.find((levelData) => levelData.level == level && levelData.episode == episode).gameData
    }
    return res
}

/*
endData "{"movesLeft":0,"movesInit":6,"movesMade":6,"seed":1736737840323,"score":780,"timeLeftPercent":-1,"reason":0,"episodeId":1,"cs":"1f21e0","levelId":1,"variant":0}"

{
  "bestResult": false,
  "newStarLevel": false,
  "episodeId": 1,
  "levelId": 1,
  "score": 600,
  "stars": 3,
  "events": [],
  "levelToplist": {
    "episodeId": 1,
    "levelId": 1,
    "toplist": [
    ]
  },
  "userUniverse": {
  },
  "currentUser": {

  }
}
*/

function getToplist(episode, level) {
    let toplist = []
    let universe = getUserUniverse()
    let UniverseEpisode = universe.episodes.find((universeepisode)=>universeepisode.id == episode)
    if (UniverseEpisode) {
        let UniverseLevel = UniverseEpisode.levels.find((universelevel)=>universelevel.id == level)
        if (UniverseLevel?.score) {
            toplist.push({
                userId: 937,
                value: UniverseLevel.score
            })
        }
    }
    return {episodeId: episode, levelId: level, toplist}
}

function gameEnd(endData) {
    //console.log(endData)
    let res = {
        bestResult: false,
        newStarLevel: false,
        episodeId: endData.episodeId,
        levelId: endData.levelId,
        score: endData.score,
        stars: 0,
        events: []
    }
    let currentUser = getCurrentUser()
    res.currentUser = currentUser

    let userUniverse = getUserUniverse()
    res.userUniverse = userUniverse

    if (endData.reason === 0) {
        //reason 0 means they have won
        
        // get stars
        let level = JSON.parse(loadedLevels[endData.episodeId][endData.levelId].gameData)
        res.stars = 0
        for (let scoreTarget of level.scoreTargets) {
            if (endData.score>=scoreTarget) {
                res.stars = level.scoreTargets.indexOf(scoreTarget)+1
            }
        }

        let episode = userUniverse.episodes.find((episode)=> episode.id == endData.episodeId)
        let levelScore = episode?.levels.find((levelentry)=> levelentry.id == endData.levelId)

        
        if (res.score > (levelScore?.score || 0) && res.stars >= (levelScore?.stars || 0)) {
            res.bestResult = true
            levelScore.score = res.score
        }

        // unlocking new levels
        let episodeCompleted = false
        let newLevelCompleted = false
        let nextLevelId;
        let nextEpisodeId;
        if (res.stars > (levelScore?.stars || 0)) {
            res.newStarLevel = true


            if (!levelScore?.stars) {
                let levelId = res.levelId + 1
                let episodeId = res.episodeId
                if (episodeId > 1200) {
                    if (episodeId <= 1202 && levelId > 10) {
                        episodeId++;
                        levelId = 1;
                        episodeCompleted = true
                    }
                    if (episodeId > 1202 && levelId > 15) {
                        episodeId++;
                        levelId = 1;
                        episodeCompleted = true
                    }
                } else {
                    if (episodeId <= 2 && levelId > 10) {
                        episodeId++;
                        levelId = 1;
                        episodeCompleted = true
                    }
                    if (episodeId > 2 && levelId > 15) {
                        episodeId++;
                        levelId = 1;
                        episodeCompleted = true
                    }
                }
                newLevelCompleted = true
                nextEpisodeId = episodeId
                nextLevelId = levelId
                res.events.push({type:"LEVEL_COMPLETED", data: JSON.stringify({episodeId: res.episodeId, levelId: res.levelId})})
                //gameEnd.events.push({type:"LEVEL_UNLOCKED", data: JSON.stringify({episodeId, levelId})})
            }

            levelScore.stars = res.stars
        }

        // this entire section only ever happens if the level was completed for the first time
        let doUnlockNextLevel = false
        // this just makes the popup appear
        if (episodeCompleted) {
            res.events.push({type:"EPISODE_COMPLETED", data: JSON.stringify({episodeId: res.episodeId})})
            // but do we unlock the next level..
            // skip the social block gates, but dreamworld
            // is only unlocked if the corresponding reality episode is cleared

            //this could cause issues with episodes 1 and 2 only having 10 levels, but the mode is only unlocked after level 50 anyways, so it's not a big deal.
            if (res.episodeId < 1200) {
                doUnlockNextLevel = true
                res.events.push({type:"EPISODE_UNLOCKED", data: JSON.stringify({episodeId: nextEpisodeId})})

                //get dreamworld episode corresponding to the PREVIOUS one
                let DWUniverseEpisode = userUniverse.episodes.find((universeepisode)=>universeepisode.id == res.episodeId+1199)
                let DWUniverseLevel = DWUniverseEpisode?.levels.find((universelevel)=>universelevel.id == 15)
                //console.log(DWUniverseEpisode)
                // if level 15 is cleared
                if (DWUniverseEpisode && DWUniverseLevel?.stars > 0) {
                    //console.log('unlocking dreamworld episode after clearing reality episode')
                    if (!userUniverse.episodes.find((universeepisode)=>universeepisode.id == res.episodeId+1200)) {
                        // we add the level to the array as well, as this is a different episode being unlocked lol
                        userUniverse.episodes.push({
                            id: res.episodeId+1200,
                            levels:[{
                                "id": 1,
                                "episodeId": res.episodeId+1200,
                                "score": 0,
                                "stars": 0,
                                "unlocked": true,
                                "completedAt": -1,
                                "unlockConditionDataList": []
                              }]
                        })
                        res.events.push({type:"EPISODE_UNLOCKED", data: JSON.stringify({episodeId: res.episodeId+1200})})
                        res.events.push({type:"LEVEL_UNLOCKED", data: JSON.stringify({episodeId: res.episodeId+1200, levelId: 1})})
                    }
                } else {
                    //console.log('not unlocking dreamworld episode - the dreamworld episode before it is not yet completed.')
                }
            } else {
                // look for reality episode unlocked that is the two episodes ahead 
                //console.log(nextEpisodeId)
                let RealityUniverseEpisode = userUniverse.episodes.find((universeepisode)=>universeepisode.id+1199 == nextEpisodeId)
                //console.log(RealityUniverseEpisode)
                if (RealityUniverseEpisode) {
                    //console.log('unlocking dreamworld episode after clearing dreamworld episode')
                    res.events.push({type:"EPISODE_UNLOCKED", data: JSON.stringify({episodeId: nextEpisodeId})})
                    doUnlockNextLevel = true
                } else {
                    //console.log('not unlocking next dreamworld episode after clearing the previous - the relevant reality episode is NOT completed.')
                }
            }
        } else if (newLevelCompleted) {
            doUnlockNextLevel = true
        }

        //console.log(`dounlocknextlevel`,doUnlockNextLevel)
        if (doUnlockNextLevel) {
            res.events.push({type:"LEVEL_UNLOCKED", data: JSON.stringify({episodeId: nextEpisodeId, levelId: nextLevelId})})
            let universeEpisode = userUniverse.episodes.find((episode)=>episode.id==nextEpisodeId)
            if (!universeEpisode) {
                universeEpisode = {
                    id: nextEpisodeId,
                    levels:[]
                }
                userUniverse.episodes.push(universeEpisode)
            }
            universeEpisode.levels.push({
                id: nextLevelId,
                episodeId: nextEpisodeId,
                score:0,
                stars:0,
                unlocked:true,
                completedAt:-1,
                unlockConditionDataList:[]
            })
        }

        /*
        // this is just to unlock the charm
        // maybe enable it in the swf so the game realizes sooner
        console.log(res.episodeId, res.levelId)
        if (res.episodeId == 2 && res.levelId == 9) {
            console.log('unlocking charm')
            if (!getBoosters(true).find((booster)=>booster.type=="CandyCharmOfFrozenTime"))
                addBoosters([{type:"CandyCharmOfFrozenTime", amount:1}], true)
        }
        */

        // give life back
        let tempUser = get('currentUser_' + currentProfile)
        tempUser.lives++
        calcLives(tempUser)
        currentUser = getCurrentUser()
    }
    res.levelToplist= getToplist(endData.episodeId, endData.levelId)
    set('userUniverse_' + currentProfile,userUniverse)
    return res
}

// later, the archived strings from other languages can be used in the resources but currently
// I just want to get the game to RUN.
function gameInitLight() {
    let currentUser = getCurrentUser()
    let resources = gameInitStrings
    let itemBalance = getBalance()
    let userUniverse = getUserUniverse()
    
    // this could change in the future..
    let language = 'en'

    return {
        currentUser,
        resources,
        properties: {
            "ad_video_activated": "false",
            "cutscene_episode_6": "bunny",
            "cutscene_episode_5": "unicorn",
            "cutscene_episode_4": "yeti",
            "cutscene_episode_3": "dragon",
            "cutscene_episode_2": "robot",
            "cutscene_episode_1": "girl"
        },
        itemBalance,
        recipes:[],
        userProfiles: [
            {
                "userId": 937,
                "externalUserId": "937",
                "lastOnlineTime": 1736338198000,
                "fullName": "You",
                "name": "You",
                "pic": "./odus100x100.png",
                "picSquare": "./odus50x50.png",
                "countryCode": "CA",
                "topEpisode": 1,
                "topLevel": 1,
                "totalStars": 0,
                "lastLevelCompletedAt": 0,
                "lastLevelCompletedEpisodeId": 0,
                "lastLevelCompletedLevelId": 0,
                "friendType": "NONE"
            }
        ],
        userUniverse,
        events: [],
        adsEnabled: false,
        daysSinceInstall: 0,
        language,
        availableBoosters: []
    }
}

function getCandyProperties() {
    let data = get('candyProperties_' + currentProfile)
    if (!data) {
        data = {

        }
        set('candyProperties_' + currentProfile, data)
    }
    return data
}

function setCandyProperty(key, value) {
    let data = getCandyProperties()
    data[key] = value
    set('candyProperties_' + currentProfile, data)
}


window.MockRequest = function(url, params) {
    url = url.split('?')[0] // candycrushapi gives the query string differently sadly
    // but we can just ignore it

    // decode the uri components for everything else
    let decoded = decodeParams(params)
    //console.log(decodedParams)
    //console.log(url, decoded)
    let result = {}
    try {
        switch (url) {
            case "http://0.0.0.0/api/gameInitLight": {
                result = gameInitLight()
                break;
            } case "http://0.0.0.0/api/handOutItemWinnings": {
                //console.log('adding this')
                let boostersAdd = JSON.parse(decoded['arg0'])
                //console.log(boostersAdd)
                addBoosters(boostersAdd)
                result = getBalance()
                break
            } 
            case "http://0.0.0.0/api/useItemsInGame": {
                //console.log('adding this')
                let boostersAdd = JSON.parse(decoded['arg0'])
                //console.log(boostersAdd)
                removeBoosters(boostersAdd)
                result = getBalance()
                break
            }
            case "http://0.0.0.0/api/gameStart2": {
                result = gameStart(decoded['arg0'], decoded['arg1'])
                break
            }
            case "http://0.0.0.0/api/getLevelToplist": {
                result = getToplist(decoded['arg0'], decoded['arg1'])
                break;
            }
            case "http://0.0.0.0/api/gameEnd3": {
                result = gameEnd(JSON.parse(decoded['arg0']))
                break
            }
            case "http://0.0.0.0/api/poll": {
                result = {currentUser: getCurrentUser()}
                break;
            }
            case "http://0.0.0.0/api/getMessages": {
                result = {events: [], currentUser: getCurrentUser()}
                break;
            }
            case "http://0.0.0.0/api/getBalance": {
                result = getBalance()
                break;
            }
            case "http://0.0.0.0/api/unlockItem": {
                result = addBoosters([{type:decoded['arg0'], amount:0}], true)
                break
            }
            case "http://0.0.0.0/candycrushapi/getWebFileUrl": {
                let wfu = decoded['arg0']
                switch (wfu) {
                    case "/s.json":
                        result = "./sales.json"
                        break
                    case "/hl.json":
                        result = "./hardlevels.json"
                        break
                    case "/lo.json":
                        result = "./liveops.json"
                        break
                }
                break
            }
            case "http://0.0.0.0/candycrushapi/getGameModes": {
                result = ["Classic", "Classic moves", "Drop down", "Light up", "Order", "Frogger", "Jelly Drop down", "Jelly Order", "Order Drop", "Jelly Color", "Jelly Time"]
                break
            }
            case "http://0.0.0.0/candycrushapi/getGameModePerLevel": {
                result = gameModesPerLevel
                break
            }
            case "http://0.0.0.0/candycrushapi/getCandyProperties": {
                result = {candyProperties: getCandyProperties()}
                break
            }
            case "http://0.0.0.0/candycrushapi/getLevelAbTests": {
                result = []
                break
            }
            case "http://0.0.0.0/candycrushapi/setCandyProperty": {
                setCandyProperty(decoded['arg0'],decoded['arg1'])
                break
            }
            case "http://0.0.0.0/candycrushapi/deliverInitialHardCurrencyGiftForIntroPop": {
                let currentUser = get('currentUser_' + currentProfile)
                setCandyProperty('introduceHardCurrency', 'true')
                if (!currentUser.hasGottenInitialGift) {
                    currentUser.gold += 50
                    currentUser.hasGottenInitialGift = true
                }
                set('currentUser_' + currentProfile,currentUser)
            }
            case "http://0.0.0.0/candycrushapi/getWheelOfBoosterPrize": {
                result = getWheelPrize()
                break
            }
            case "http://0.0.0.0/api/setSoundFx": {
                let currentUser = get('currentUser_' + currentProfile)
                currentUser.soundFx = JSON.parse(decoded['arg0'])
                set('currentUser_' + currentProfile, currentUser)
                break
            }
            case "http://0.0.0.0/api/setSoundMusic": {
                let currentUser = get('currentUser_' + currentProfile)
                currentUser.soundMusic = JSON.parse(decoded['arg0'])
                set('currentUser_' + currentProfile, currentUser)
                break
            }
            default: {
                //console.log(url, decoded)
            }
        }
    } catch (err) {
        console.error(err)
    }
    //console.log(result)
    return JSON.stringify(result)
}


function getProductPackages() {
    let res = [

    ]
    for (let product of window.PackagePrice) {
        let package = {
            "type": parseInt(product.productId),
            "products": [

            ],
            "prices":[{"cents":0,currency:"CAD"},{"cents":product.price * 100,currency:"KHC"}],
            "listPrices":[{"cents":0,currency:"CAD"},{"cents":product.price * 100,currency:"KHC"}],
        }
        for (let item of product.items) {
            let packageProduct = {
                "itemType": parseInt(item.itemId),
                "prices":[{"cents":0,currency:"CAD"},{"cents":product.price * 100,currency:"KHC"}],
                "listPrices":[{"cents":0,currency:"CAD"},{"cents":product.price * 100,currency:"KHC"}],
                "discountFactorPercent": 100
            }

            if (item.deliverItemId == "3280") {
                packageProduct.deliverData = JSON.stringify({
                    "amount": item.deliverKHCAmount,
                    "currency": "KHC"
                })
                package.listPrices[0].cents = 0
            } else if (item.deliverItemId) {
                packageProduct.deliverData = JSON.stringify({
                    "amount":item.amount,
                    "itemType":{
                        "id": parseInt(item.deliverItemId),
                        "name":item.deliverItemType,
                        "shortName":item.deliverItemType,
                        "description":"",
                        "category":"candyBooster",
                        "itemTypeFamily":"None"
                    }
                })
            }
            //if (item.deliverData) {
            //    packageProduct.deliverData - item.deliverData
            //}
            package.products.push(packageProduct)
        }
        res.push(package)
    }
    return res
}

function handlePurchase(purchaseParams, isGoldPurchase) {
    //console.log(purchaseParams)
    let PackageId = purchaseParams.orderItems[0]?.productPackageType
    let Package = window.PackagePrice.find((package)=>package.productId == PackageId)
    //console.log(Package)

    let currentUser = get('currentUser_' + currentProfile)
    if (isGoldPurchase || currentUser.gold >= Package.price) {
        if (!isGoldPurchase) {
            //console.log('removing gold...')
            currentUser.gold -= Package.price
        }
        //console.log('adding boosters', Package.items.map((booster)=>({amount: booster.amount, type: booster.deliverItemType})))
        addBoosters(Package.items.map((booster)=>({amount: booster.amount, type: booster.deliverItemType})), false)

        // for the special item types
        for (let item of Package.items) {
            switch (item.deliverItemType || item.itemType) {
                case "CandyFullLife": {
                    //console.log('refilling lives')
                    currentUser.lives = currentUser.maxLives
                    calcLives(currentUser)
                    break
                }
                case "CandyHardCurrency": {
                    //console.log('adding gold from itemDeliverKHCAmount')
                    currentUser.gold += item.deliverKHCAmount
                }
            }
        }

        set('currentUser_' + currentProfile, currentUser)
        //console.log('done purchase')
        return {
            status: "ok",
            error: "",
            transactionId: "example",
            isPurchaseForAnotherUser: false
        }
    }
    return {
        status: "error",
        error: "ur too broke lol",
        transactionId: "example",
        isPurchaseForAnotherUser: false
    }
}

//game.externalInterfaceRpcReceive
//ExternalInterfaceRpc.receive
window.ExternalInterfaceRpc = {
    receive: function(rpc) {
        //console.log(rpc.method)
        result = []
        switch (rpc.method) {
            case "ProductApi.getUserCurrency": {
                result = "CAD"
                break;
            }
            case "ProductApi.getAllProductPackages": {
                result = getProductPackages()
                break
            }
            case "ProductJsApi.getPurchaseOutcomesToDisplay": {
                result = []
                break
            }
            case "ProductApi.purchase": {
                result = handlePurchase(rpc.params[0])
                break
            }
            case "ProductJsApi.buy2": {
                result = handlePurchase(rpc.params[0], true)
                break;
            }
            default: {
                console.warn(`unknown method ${rpc.method}`, rpc.params)
                break
            }
        }

        setTimeout(()=>{
            try {
                //console.log(result)
                game.externalInterfaceRpcReceive({
                        id: rpc.id,
                        result: result
                })
            } catch (err) {
                //console.error(err)
            }
        },250)
    }
}


// load levels
fetch('./resources/game-configuration.json').then(res=>res.json().then((levels)=>{
    loadedLevels = {
    }
    for (let level of levels) {
        if (!loadedLevels[level.episode]) {
            loadedLevels[level.episode] = {}
        }
        loadedLevels[level.episode][level.level] = level
    }
    console.log('loaded levels!')
}))

fetch('./candycrushapi/getGameModePerLevel').then(res=>res.json().then((json)=>{
    gameModesPerLevel = json
    console.log('loaded game modes per level')
}))